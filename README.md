# 레츠댄스: VGA 기반 K-Dance 모션 인식 게임

## Repository 구성
- **Final_Basys3.ver** : Basys3 보드에서 작동하는 해당 프로젝트 종합 소스코드 폴더
  - **0924_VGA_OV7670_final_backup** : Vivado 에서 작동하는 HW 소스코드
  - **motion_game_ver2** : VSCode에서 작동하는 Python 기반 SW(GUI) 소스코드
- **Report** : 최종 프로젝트 정리 문서 자료 (ppt, pdf) - 제본용, 발표용
- **final_zybo.ver** : 해당 프로젝트의 zybo z7-20 및 pcam 버전 HW 소스코드

## 프로젝트 선정 배경
- **문제 인식** : 현대 사회에 들어 지속적으로 증가하는 우울감과 스트레스
- **해결 방안** : K-POP은 글로벌 시장에서 큰 인기를 얻고 있다. K-POP은 긴장감을 풀어주고 **용기**를 북돋아주며, **긍정**적인 에너지를 전달한다.

## 프로젝트 개요
실시간 카메라 입력(OV7670)을 VGA 파이프라인으로 처리하여 **댄스 가이드 패턴과 사용자의 동작 일치율을 측정**하고 점수를 산출하는 게임입니다. 시작/곡 선택은 **특정 색(빨간색) 인식**으로 입력받으며, 게임 종료 후 점수를 **랭킹 보드**에 기록합니다.

- **종료 조건**: 음악 선택 후 나오는 모든 안무 패턴 종료 시
- **점수 등급**: Perfect ≥ 80%, Good 50–80%, Bad < 50%
- **촬영 조건 예시**: 카메라–사용자 거리 약 4.8 m

## 주요 기능
- **실시간 영상 전처리**: Median(노이즈 저감), Gray(색상 단순화), Sobel(에지 검출), + (파이프라인)
- **패턴 매칭**: PIP(Point In Polygon) + **Ray Crossing**으로 패턴 내부/외부 판정, 30개 선분 병렬 처리
- **게임 FSM**: 시작/선택/플레이/종료 상태 전이, **UART 연계 Python UI**로 랭킹 입력 및 UI 표시
- **타이밍 정합**: PIP 내부에서 **3FF**로 비디오 데이터 영역과 패턴 데이터 영역의 **CDC**문제 해결

## 시스템 아키텍처
카메라(OV7670) → Basys3(PL) → VGA/HDMI 출력   
**UART**를 통해 PC(Python GUI)와 통신   

- **Toolchain**: Vivado 2020.2, Xilinx Vitis / VS Code
- **HW**: Basys3, OV7670, VGA→HDMI 케이블, 캡쳐 보드

## 알고리즘
### 전처리 필터
- **Median**: 주변 픽셀 정렬 → **중앙값** 출력으로 salt-and-pepper 제거
- **Gray**: 색상 성분 축소로 연산 축소
- **Sobel**: 엣지 강조

### 패턴 검출 (PIP + Ray Crossing)
- **Point In Polygon**: 점이 다각형 **내부인지 판정**
- **Ray Crossing**: x 증가 방향으로 레이를 쏴 **교차 수 홀/짝**에 따라 내부/외부 결정.    
- **640×480 좌표계**, **30개 선분 병렬** 생성 및 XOR 연산으로 내부는 1, 외부는 0으로 최종 출력
- **패턴 자동화**: 수작업 좌표 추출의 비효율을 개선하기 위해 **Python으로 이미지→좌표 자동 추출** 구조 구축

## 점수 산정
- **일치율 기반 등급**: Perfect / Good / Bad 
- **주의**: VGA Blanking(Front/Back Porch, Sync) 영역은 **카운트 제외**해야 하며, 미제외 시 Red 카운트로 오탐 발생

## 트러블슈팅
- **FSM 전이 안 됨**: RX_FIFO **POP 미연결**로 UART 데이터 업데이트 불가 → **수신 완료 후 Pop** 신호 출력하도록 수정
- **패턴 출력 노이즈**: 비디오/패턴 경로 레이턴시 불일치 → **PIP 내부 3FF Synchronizer**로 해결
- **리소스 초과**: 기존 곱 연산이었던 구조를 → dx/dy 기반 **구간별 덧셈**(shift/add)구조로 변경 → LUT/DSP 절감

## 개발/검증
- **SystemVerilog Verification** : 제너레이터/드라이버/모니터/스코어보드 구성으로 검증
- **CDC/ASM Chart**로 FSM 명세 및 동기화 설계

## 활용 분야
- **Home Fitness / Smart Home IoT**: 집에서 쉽게 따라하는 체조 및 동작 인식  
- **안전 모니터링**: 낙상 방지—지정 영역 이탈 감지 알람
- **K-POP 챌린지**: 점수 공유/영상 업로드로 **SNS 확산** 기대

## 팀
문우진 · 김병현 · 김을중 · 박승범 · 안재용 · 오정일 · 정은지

---

---

